redis cluster，10 台机器，5 台机器部署了 redis 主实例，另外 5 台机器部署了 redis 的从实例，每个主实例挂了一个从实例，5 个节点对外提供读写服务，每个节点的读写高峰qps可能可以达到每秒 5 万，5 台机器最多是 25 万读写请求/s。

机器是什么配置？32G 内存+ 8 核 CPU + 1T 磁盘，但是分配给 redis 进程的是10g内存，一般线上生产环境，redis 的内存尽量不要超过 10g，超过 10g 可能会有问题。


Redis中的布隆过滤器底层是一个大型位数组（二进制数组）+多个无偏hash函数，判断存在有可能不存在，判断不存在一定不存在。
哈希算法MurmurHash
缓存穿透 布隆过滤器，缓存中设置空值
缓存击穿 热点数据缓冲失效后，先设置互斥锁，再load DB
缓存雪崩 使用锁或队列、设置过期标志更新缓存、为key设置随机不同的缓存失效时间

采用LRU策略处理溢出，Redis的RDB和AOF持久化策略来保证一定情况下的数据安全。

--------------------------------------------------------------------------------
ziplist 所有元素长度都小于64个字节，元素数量小于512
intset[encoding|length|contents] 所有元素都是整数， 元素数量小于512 
当列表、散列、有序集合的长度较短或者体积较小的时候，redis将会采用一种名为ziplist的紧凑存储方式来存储这些结构。

字符串 int, raw, embstr
列表 ziplist, 双链表 
散列 ziplist, 哈希表
集合 intset，哈希表
有序集合 ziplist，skiplist
--------------------------------------------------------------------------------

1、为啥redis单线程模型也能效率这么高？
1）纯内存操作
2）核心是基于非阻塞的IO多路复用机制
3）单线程反而避免了多线程的频繁上下文切换问题
2、Redis有哪些数据结构？
string set order_set list hash

3、Redis相比memcached有哪些优势？
memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型
redis的速度比memcached快很多
redis可以持久化其数据
redis支持数据的备份，即master-slave模式的数据备份。
redis最大value可以达到1GB，而memcache只有1MB

4、Redis有哪些适合的场景？
缓存，排行榜，计数器，分布式会话，分布式锁，社交网络，最新列表，消息系统
5、Redis有哪几种数据淘汰策略？
redis 提供 6种数据淘汰策略：
redis 内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。redis 提供 6种数据淘汰策略：
volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰
volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰
volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰
allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰
allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰
no-enviction（驱逐）：禁止驱逐数据

6、使用过Redis分布式锁么，它是什么回事？
先拿 setnx 来争抢锁，抢到之后，再用 expire 给锁加一个过期时间防止锁忘记了释放。

7、假如Redis里面有1亿个key，其中有10w个key是以某个固定的已知的前缀开头的，如何将它们全部找出来？
8、由7接着问：如果这个redis正在给线上的业务提供服务，那使用keys指令会有什么问题？
9、如果有大量的key需要设置同一时间过期，一般需要注意什么？
redis可能会出现短暂的卡顿现象。一般需要在时间上加一个随机值,使得过期时间分散一些。
10、如何处理redis集群中big key和hot key？
设计key拆分数据
给hot key加上前缀或者后缀，把一个hotkey 的数量变成 redis 实例个数N的倍数M，从而由访问一个 redis key 变成访问 N * M 个redis key。

Redis自4.0起提供了hotkeys参数来方便用户进行实例级的热Key分析功，该参数能够返回所有Key的被访问次数，redis-server的maxmemory-policy参数设置为LFU。
热Key的产生来自于读请求，那么读写分离是一个很好的解决方案
读写压力都较大写对数据一致性要求很高的场景下，读写分离架构并不合适。

11、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？
计算20W 数据大约占用的内存，设置Redis 内存限制即可，推荐Allkeys-lru淘汰策略

缓存每命中一次,就给命中的缓存增加一定ttl(过期时间)(根据具体情况来设定, 比如1分钟).
一段时间后, 热数据的ttl都会较大, 不会自动失效, 而冷数据基本上过了设定的ttl就马上失效了.

12、使用过Redis做异步队列么，你是怎么用的？
使用list结构作为队列，rpush生产消息，lpop消费消息，当lpop没有消息的时候，要适当sleep一会再重试。
或者，不用sleep，直接用blpop指令，在没有消息的时候，它会阻塞住直到消息到来。

消息发布者，即publish客户端，无需独占链接
消息订阅者，即subscribe客户端，需要独占链接
在消费者下线的情况下，生产的消息会丢失。

13、如果对方追问redis如何实现延时队列？
使用ZSet，拿时间戳作为score，消息内容作为key,调用zadd来生产消息，消费者用zrangebyscore指令获取指定时间之前的数据轮询进行处理。

14、说说Redis哈希槽的概念？
哈希槽其实是两个概念，第一个是哈希算法。
Redis Cluster的hash算法不是简单的hash()，而是crc16算法，一种校验算法。

另外一个就是槽位的概念，空间分配的规则。
一致性哈希的空间是一个圆环，节点分布是基于圆环的，无法很好的控制数据分布。
而Redis Cluster的槽位空间是自定义分配的，类似于Windows盘分区的概念。这种分区是可以自定义大小，自定义位置的。

15、Redis中的Pipeline有什么好处，为什么要用pipeline？
pipeline功能的原理是 客户端通过一次性将多条redis命令发往Redis 服务端，减少了每条命令分别传输的IO开销。同时减少了系统调用的次数，因此提升了整体的吞吐能力。

16、Redis与其他key-value存储有什么不同？
Redis有着更为复杂的数据结构并且提供对他们的原子性操作
运行在内存中但是可以持久化到磁盘

17、Redis和Redisson有什么关系？Jedis与Redisson对比有什么优缺点？
Jedis 是 Redis 的 Java 实现的客户端，其 API 提供了比较全面的 Redis 命令 
的支持；Redisson 实现了分布式和可扩展的 Java 数据结构，和 Jedis 相比，功能 
较为简单，不支持字符串操作，不支持排序、事务、管道、分区等 Redis 特性。
Redisson 的宗旨是促进使用者对 Redis 的关注分离，从而让使用者能够将精力更 
集中地放在处理业务逻辑上。

19、支持一致性哈希的客户端有哪些？
①先构造一个长度为232的整数环（称作一致性Hash环），
②根据节点名称的Hash值（其分布范围为[0, 232-1]）将缓存服务器节点放置在这个Hash环上；（要保证n个服务器节点均衡地放置在环上）
③根据缓存数据的key的Hash值（其分布范围也为[0, 232-1]）在Hash环上顺时针查找距离这个key的Hash值最近的缓存服务器节点，即为该数据应该放置的的服务器。

20、Twemproxy是什么？
主要用于管理 Redis 和 Memcached 集群，减少与Cache 服务器直接连接的数量。

21、怎么理解Redis事务？
MULTI ：开启事务，redis会将后续的命令逐个放入队列中，然后使用EXEC命令来原子化执行这个命令系列。
EXEC：执行事务中的所有操作命令。
DISCARD：取消事务，放弃执行事务块中的所有命令。
WATCH：监视一个或多个key,如果事务在执行前，这个key(或多个key)被其他命令修改，则事务被中断，不会执行事务中的任何命令。
UNWATCH：取消WATCH对所有key的监视。
Redis不支持事务回滚
在运行时检测类型错误，最终导致事务提交失败，此时事务并没有回滚，而是跳过错误命令继续执行

22、Redis回收进程如何工作的？
添加了新的数据。Redi 检查内存使用情况，如果大于 maxmemory 的限制, 则根据设定好的策略进行回收。

23、Redis回收使用的是什么算法？
引用计数算法（缺点：循环引用问题）
LRU是Least Recently Used的缩写，即最近最少使用

24、Redis如何做大量数据插入？
Shell+redis客户端可以批量插入数据
cat data.txt | redis-cli --pipe

25、为什么要做Redis分区？
1、性能的提升，单机Redis的网络I/O能力和计算资源是有限的，将请求分散到多台机器，充分利用多台机器的计算能力可网络带宽，有助于提高Redis总体的服务能力。
2、存储的横向扩展，即使Redis的服务能力能够满足应用需求，但是随着存储数据的增加，单台机器受限于机器本身的存储容量，将数据分散到多台机器上存储使得Redis服务可以横向扩展。

26、你知道有哪些Redis分区实现方案？
范围分区
哈希分区

27、Redis分区有什么缺点？
多键的Redis事务不被支持
不能将关联到一个键的很大的数据集映射到不同的实例
添加和删除机器是很复杂的
需要处理多个rdb/aof文件，将分布在不同实例的文件聚集到一起备份。

28、为什么Redis需要把所有数据放到内存中？
如果不将数据放到内存中,磁盘的I/O速度会严重影响redis的性能。

29、Redis的内存占用情况怎么样？
redis占用了多少内存，那么可以用“info”命令查看
used_memory:13490096 //数据占用了多少内存（字节）
used_memory_human:12.87M //数据占用了多少内存（带单位的，可读性好）
used_memory_rss:13490096  //redis占用了多少内存
used_memory_peak:15301192 //占用内存的峰值（字节）
used_memory_peak_human:14.59M //占用内存的峰值（带单位的，可读性好）
used_memory_lua:31744  //lua引擎所占用的内存大小（字节）
mem_fragmentation_ratio:1.00  //内存碎片率
mem_allocator:libc //redis内存分配器版本，在编译时指定的。有libc、jemalloc、tcmalloc这3种。

30、都有哪些办法可以降低Redis的内存使用情况呢？
当列表、散列、有序集合的长度较短或者体积较小的时候，redis将会采用一种名为ziplist的紧凑存储方式来存储这些结构。
ziplist是列表、散列、有序集合这三种不同类型的对象的一种非结构化表示，
它会以序列化的方式存储数据，这些序列化的数据每次被读取的时候都需要进行解码，每次写入的时候也要进行编码。

31、Redis的内存用完了会发生什么？
如果达到设置的上限，Redis写命令返回错误，读命令正常
如果配置了淘汰机制，当 Redis 达到内存上限时会冲刷掉旧的内容。

32、Redis如何做内存优化？
https://zhuanlan.zhihu.com/p/55068567

33、Redis如何做持久化的？
34、bgsave的原理是什么？
① 执行 bgsave 命令，Redis 父进程判断当前是否存在正在执行的子进程，如 RDB/AOF 子进程，如果存在 bgsave 命令直接返回。
② 父进程执行 fork 操作创建子进程，fork 操作过程中父进程会阻塞。
③ 父进程 fork 完成后，bgsave 命令返回并不再阻塞父进程，可以继续响应其他命令。
④ 子进程创建 RDB 文件，根据父进程内存生成临时快照文件，完成后对原有文件进行原子替换。
⑤ 进程发送信号给父进程表示完成，父进程更新统计信息。

35、Redis提供了哪几种持久化方式？
RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。
AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。
https://www.cnblogs.com/chenliangcl/p/7240350.html

36、如何选择合适的持久化方式？
二者选择的标准，就是看系统是愿意牺牲一些性能，换取更高的缓存一致性（aof）
还是愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动运行save的时候，再做备份（rdb）
rdb 单个文件，文件小，恢复快，IO操作少
aof 数据安全性更高，数据集大时不会导致卡顿

37、Redis是单线程的，如何提高多核CPU的利用率？
同一个服务器部署多个 Redis 实例

38、Redis常见性能问题和解决方案？
set-max-intset-entries 512 #限制集合中member个数，超出则不采取intset存储
当集合中的所有成员都能够被解析为十进制数据时，将会采用intset存储方式，这不仅能够节省内存，而且还可以提高响应的性能。
打包存储二进制位和字节

39、修改配置不重启Redis会实时生效吗？
40、Redis的同步机制了解么？
41、是否使用过Redis集群，集群的原理是什么？
42、Redis集群方案应该怎么做？都有哪些方案？
43、Redis集群方案什么情况下会导致整个集群不可用？
44、Redis集群的主从复制模型是怎样的？
44、Redis的集群方案之间都有哪些区别，其优点和缺点是什么？
45、Redis集群会有写操作丢失吗？为什么？
46、Redis集群之间是如何复制的？
Psync
47、Redis集群最大节点个数是多少？
2^14  CRC16
48、一个Redis实例最多能存放多少的keys？List、Set、Sorted Set他们最多能存放多少元素？
理论上2^32次方个
49、Redis持久化数据和缓存怎么做扩容？
1、如果Redis被当做缓存使用，使用一致性哈希实现动态扩容缩容。
2、如果Redis被当做一个持久化存储使用，必须使用固定的keys-to-nodes映射关系，节点的数量一旦确定不能变化。否则的话(即Redis节点需要动态变化的情况），必须使用可以在运行时进行数据再平衡的一套系统，而当前只有Redis集群可以做到这样。

50、分布式Redis是前期做还是后期规模上来了再做好？为什么？
前期做，redis内存初始化占用低
